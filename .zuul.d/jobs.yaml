---
- job:
    name: windmill-config-promote-base
    abstract: true
    pre-run: tests/playbooks/promote-base/pre.yaml
    post-run: tests/playbooks/promote-base/post.yaml
    allowed-projects:
      - ansible-network/windmill-config
      - ansible/project-config
    nodeset:
      nodes: []
    semaphore: windmill-config-deploy

- job:
    name: windmill-config-deploy
    parent: windmill-config-promote-base
    run: tests/playbooks/deploy/run.yaml
    dependencies:
      - name: project-config-github-promote
        soft: true
      - name: windmill-config-dns-promote
        soft: true
    required-projects:
      - name: github.com/ansible-network/windmill-config
      - name: github.com/ansible/project-config
      - name: git.openstack.org/openstack/windmill
      - name: git.openstack.org/openstack/windmill-backup
      - name: git.openstack.org/openstack/windmill-ops

- job:
    name: windmill-config-dns-promote
    parent: windmill-config-promote-base
    run: tests/playbooks/windmill-config-dns-promote/run.yaml
    required-projects:
      - name: github.com/ansible-network/windmill-config
    files:
      - ansible/hosts.yaml
      - tests/playbooks/windmill-config-dns-promote/.*

- job:
    name: project-config-github-promote
    parent: windmill-config-promote-base
    run: tests/playbooks/project-config-github-promote/run.yaml
    required-projects:
      - name: github.com/ansible/project-config
    files:
      - github/projects.yaml
      - tools/manage-projects.py
